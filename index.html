<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>简易 JS-Native 接口检测</title>
<style>
  body { font-family: monospace; background: #fafafa; color: #111; padding: 10px; }
  .risk-high { color: red; font-weight: bold; }
  .risk-medium { color: orange; font-weight: bold; }
  .safe { color: #333; }
</style>
</head>
<body>
<div id="res"></div>

<script>
/*
============================================================
  简易 JS-Native 接口检测脚本（类似 show_js.html）
  功能：
    1. 遍历 window 上的所有属性；
    2. 过滤浏览器内置对象；
    3. 输出可疑（注入）对象及其子属性；
    4. 根据名称判断风险级别并标红显示。
============================================================
*/

(function(){

  // ---------- 一、浏览器原生属性白名单 ----------
  var browserList = [
    "window","document","location","navigator","history","screen",
    "alert","confirm","prompt","fetch","setTimeout","clearTimeout",
    "setInterval","clearInterval","btoa","atob","localStorage",
    "sessionStorage","indexedDB","crypto","frames","parent","top",
    "addEventListener","removeEventListener","postMessage"
  ];

  // ---------- 二、风险关键字表 ----------
  var riskWords = {
    high: ["install","apk","download","exec","shell","cmd","delete"],
    medium: ["open","start","intent","activity","getDevice","getIMEI","getLocation"],
  };

  // ---------- 三、判断风险等级 ----------
  function checkRisk(name){
    var lower = name.toLowerCase();
    for (var i of riskWords.high) if (lower.includes(i)) return "high";
    for (var j of riskWords.medium) if (lower.includes(j)) return "medium";
    return "safe";
  }

  // ---------- 四、检测 window 对象 ----------
  var resDiv = document.getElementById('res');
  var found = [];
  for (var key in window) {
    if (browserList.indexOf(key) === -1) {  // 过滤白名单
      found.push(key);
    }
  }

  // ---------- 五、输出检测结果 ----------
  var html = "";
  html += "<b>共发现 " + found.length + " 个非白名单对象：</b><br><br>";

  found.forEach(function(name){
    var risk = checkRisk(name);
    var colorClass = (risk === "high" ? "risk-high" :
                      risk === "medium" ? "risk-medium" : "safe");

    html += `<div class="${colorClass}">${name} (${risk})</div>`;

    try {
      var obj = window[name];
      if (obj && typeof obj === "object") {
        for (var sub in obj) {
          var subRisk = checkRisk(sub);
          var subClass = (subRisk === "high" ? "risk-high" :
                          subRisk === "medium" ? "risk-medium" : "safe");
          html += `---- <span class="${subClass}">${typeof obj[sub]}: ${sub}</span><br>`;
        }
      }
    } catch(e) {
      html += "---- 无法访问属性<br>";
    }

    html += "<br>";
  });

  resDiv.innerHTML = html;

  // ---------- 六、执行结束提示 ----------
  alert("检测完成，共发现 " + found.length + " 项。");

})();
</script>
</body>
</html>